# Contributor: Carlo Landmeter <clandmeter@gmail.com>
# Maintainer: Patrycja Rosa <alpine@ptrcnull.me>
pkgname=librespot
pkgver=0.5.0
pkgrel=0
builddir="$srcdir/$pkgname-dev"
pkgdesc="Open Source Spotify client library"
url="https://github.com/librespot-org/librespot"
# loongarch64: blocked by libc crate
arch="all !s390x !riscv64 !loongarch64" # limited by cargo
license="MIT"
options="!check" # no test suite
makedepends="cargo pulseaudio-dev cargo-auditable cmake clang16-dev"
install="$pkgname.pre-install"
subpackages="$pkgname-openrc"
source="$pkgname-dev.tar.gz::https://github.com/librespot-org/librespot/archive/refs/heads/dev.tar.gz
	$pkgname.initd
	$pkgname.confd
	"


prepare() {
	default_prepare

	cargo fetch --target="$CTARGET" --locked
}

build() {
	cargo auditable build --release --frozen \
		--no-default-features --features pulseaudio-backend
}

package() {
	install -Dm755 target/release/librespot "$pkgdir"/usr/bin/librespot
	install -Dm755 "$srcdir"/$pkgname.initd "$pkgdir"/etc/init.d/$pkgname
	install -Dm644 "$srcdir"/$pkgname.confd "$pkgdir"/etc/conf.d/$pkgname
}

sha512sums="
62377c0c7b868a5414c3e62b5edcac118f83c0bf1e218c9aa6e8174c875ab63707fc1eef2e64188bf2aac2891cbbd4fddc086cb4b9b4a760ded20c63fe4f8ebe  pkgname-dev.tar.gz
c7cf6dd1afc67d02c710cd01baacee3084812cbf326514667c9b053fe0b4b7769fdac9f7fc4c2e3ee9755c6fe6d3b9bf4fda1279e507e0abd254157adf44d4c2  librespot.initd
7be717bbe23b40d6c52b1e9b1ce4cb6d5f243b75ce5479a28fa3fff97f7e80f565321a839259ae7ee4eba47f490f1c0aec72b52e71d25620a98e4c7bcd696cde  librespot.confd
"
